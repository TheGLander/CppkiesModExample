!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}function n(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))}var o=!window.__INTERNAL_CPPKIES__;o&&(window.__INTERNAL_CPPKIES__={hiddenMilkMult:1,minigames:{},injectedHooks:new Set,injectedBuildingHooks:{},isFirstLoad:!0,savePartitions:{},customAchievements:[],customBuildings:[],customTiers:[],customUpgrades:[],mods:[]});var i="";__INTERNAL_CPPKIES__.customBuildings;var r=__INTERNAL_CPPKIES__.customAchievements,a=__INTERNAL_CPPKIES__.customUpgrades;__INTERNAL_CPPKIES__.customTiers;var s=__INTERNAL_CPPKIES__.mods,l=null;function c(e){l=e}function u(e){l&&(e.owner=l,l.ownedUnits.push(e))}var f={},m=[];function p(e){if(m.includes(e))throw new Error("Recursive alias");return m.push(e),e in f?p(f[e]):(m=[],e)}function d(e){return void 0===(e=n([],e,!0))[2]||null===e[2]?e[2]=p(i):e[2]=p(e[2]),e}function h(e,t){var n=null===t[0],o=new RegExp("");switch(null!==t[0]&&((o="string"==typeof t[0]?new RegExp(function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}(t[0]),"g"):t[0]).test(e)||console.warn("Nothing to inject.")),t[2]){case"before":e=n?e.replace(/(\)[^{]*{)/,"$1".concat(t[1])):e.replace(o,"".concat(t[1]).concat(t[0]));break;case"replace":e=n?t[1]:e.replace(o,t[1]);break;case"after":e=n?e.replace(/(}?)$/,"".concat(t[1],"$1")):e.replace(o,"".concat(t[0]).concat(t[1]));break;default:throw new Error('where Parameter must be "before", "replace" or "after"')}return e}function v(e,t,o,i,r){void 0===r&&(r={});var a=Function.apply(void 0,n(n([],Object.keys(r),!1),["return (".concat(h(e.toString(),[t,o,i]),")")],!1)).apply(void 0,Object.values(r));return a.prototype=e.prototype,a}function g(e,t,o){void 0===o&&(o={});for(var i=e.toString(),r=0,a=t;r<a.length;r++)i=h(i,a[r]);var s=Function.apply(void 0,n(n([],Object.keys(o),!1),["return (".concat(i,")")],!1)).apply(void 0,Object.values(o));return s.prototype=e.prototype,s}function _(e,t){for(var n in t)e[n]=t[n]}var w=String.fromCharCode,P=function(e,t,n){if(null==e)return"";var o,i,r,a={},s={},l="",c="",u="",f=2,m=3,p=2,d=[],h=0,v=0;for(r=0;r<e.length;r+=1)if(l=e.charAt(r),Object.prototype.hasOwnProperty.call(a,l)||(a[l]=m++,s[l]=!0),c=u+l,Object.prototype.hasOwnProperty.call(a,c))u=c;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(o=0;o<p;o++)h<<=1,v==t-1?(v=0,d.push(n(h)),h=0):v++;for(i=u.charCodeAt(0),o=0;o<8;o++)h=h<<1|1&i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i>>=1}else{for(i=1,o=0;o<p;o++)h=h<<1|i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i=0;for(i=u.charCodeAt(0),o=0;o<16;o++)h=h<<1|1&i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i>>=1}0==--f&&(f=Math.pow(2,p),p++),delete s[u]}else for(i=a[u],o=0;o<p;o++)h=h<<1|1&i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i>>=1;0==--f&&(f=Math.pow(2,p),p++),a[c]=m++,u=String(l)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(o=0;o<p;o++)h<<=1,v==t-1?(v=0,d.push(n(h)),h=0):v++;for(i=u.charCodeAt(0),o=0;o<8;o++)h=h<<1|1&i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i>>=1}else{for(i=1,o=0;o<p;o++)h=h<<1|i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i=0;for(i=u.charCodeAt(0),o=0;o<16;o++)h=h<<1|1&i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i>>=1}0==--f&&(f=Math.pow(2,p),p++),delete s[u]}else for(i=a[u],o=0;o<p;o++)h=h<<1|1&i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i>>=1;0==--f&&(f=Math.pow(2,p),p++)}for(i=2,o=0;o<p;o++)h=h<<1|1&i,v==t-1?(v=0,d.push(n(h)),h=0):v++,i>>=1;for(;;){if(h<<=1,v==t-1){d.push(n(h));break}v++}return d.join("")},b=function(e,t,n){var o,i,r,a,s,l,c,u=[],f=4,m=4,p=3,d="",h=[],v={val:n(0),position:t,index:1};for(o=0;o<3;o+=1)u[o]=o;for(r=0,s=Math.pow(2,2),l=1;l!=s;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=n(v.index++)),r|=(a>0?1:0)*l,l<<=1;switch(r){case 0:for(r=0,s=Math.pow(2,8),l=1;l!=s;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=n(v.index++)),r|=(a>0?1:0)*l,l<<=1;c=w(r);break;case 1:for(r=0,s=Math.pow(2,16),l=1;l!=s;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=n(v.index++)),r|=(a>0?1:0)*l,l<<=1;c=w(r);break;case 2:return""}for(u[3]=c,i=c,h.push(c);;){if(v.index>e)return"";for(r=0,s=Math.pow(2,p),l=1;l!=s;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=n(v.index++)),r|=(a>0?1:0)*l,l<<=1;switch(c=r){case 0:for(r=0,s=Math.pow(2,8),l=1;l!=s;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=n(v.index++)),r|=(a>0?1:0)*l,l<<=1;u[m++]=w(r),c=m-1,f--;break;case 1:for(r=0,s=Math.pow(2,16),l=1;l!=s;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=n(v.index++)),r|=(a>0?1:0)*l,l<<=1;u[m++]=w(r),c=m-1,f--;break;case 2:return h.join("")}if(0==f&&(f=Math.pow(2,p),p++),u[c])d=u[c];else{if(c!==m)return null;d=i+i.charAt(0)}h.push(d),u[m++]=i+d.charAt(0),i=d,0==--f&&(f=Math.pow(2,p),p++)}};Game.dragonLevels.length;var k=function(e,t,n){this.name=e,this.version=t,this.resetOn=n,u(this);var o=__INTERNAL_CPPKIES__.savePartitions[e];this.active=!o||t>o.version,this.active&&(o&&(o.active=!1),__INTERNAL_CPPKIES__.savePartitions[e]=this)};!function(e){function n(t,n,o,i,r,a){var s=e.call(this,t,n,o)||this;return s.save=i,s.load=r,s.reset=a,s}t(n,e),n.prototype.saveAll=function(e){var t;null===(t=this.save)||void 0===t||t.call(this,e)},n.prototype.loadAll=function(e){var t;null===(t=this.load)||void 0===t||t.call(this,e)},n.prototype.resetAll=function(e,t){var n;"never"!==this.resetOn&&("mixed"!==this.resetOn?"soft"!==this.resetOn&&"hard"!==t||delete e[this.name]:null===(n=this.reset)||void 0===n||n.call(this,e,t))}}(k);var E=function(e){function n(t,n,o,i,r,a){var s=e.call(this,t,n,o)||this;return s.save=i,s.load=r,s.reset=a,s}return t(n,e),n.prototype.saveAll=function(e){this.save(e.foreign);for(var t=0,n=s;t<n.length;t++){var o=n[t];this.save(e.mods[o.keyname],o)}},n.prototype.loadAll=function(e){this.load(e.foreign);for(var t=0,n=s;t<n.length;t++){var o=n[t];this.load(e.mods[o.keyname],o)}},n.prototype.resetOne=function(e,t){var n;"never"!==this.resetOn&&("mixed"!==this.resetOn?"soft"!==this.resetOn&&"hard"!==t||delete e[this.name]:null===(n=this.reset)||void 0===n||n.call(this,e,t))},n.prototype.resetAll=function(e,t){for(var n=0,o=Object.values(e.mods);n<o.length;n++){var i=o[n];this.resetOne(i,t)}},n}(k),y=function(e){function n(t,n,o,i,r,a){var s=e.call(this,t,n,o)||this;return s.save=i,s.load=r,s.reset=a,s}return t(n,e),n.prototype.saveAll=function(e){e.minigames||(e.minigames={}),this.save(e.minigames)},n.prototype.loadAll=function(e){e.minigames&&this.load(e.minigames)},n.prototype.resetAll=function(e,t){var n;e.minigames&&"never"!==this.resetOn&&("mixed"!==this.resetOn?"soft"!==this.resetOn&&"hard"!==t||delete e.minigames[this.name]:null===(n=this.reset)||void 0===n||n.call(this,e.minigames,t))},n}(k);function I(){return{mods:{},foreign:{custom:null},saveVer:3,identification:{seed:Game.seed,startDate:Game.startDate}}}var N=I();function S(){var e=I();_(N,e)}function C(e){for(var t=0,n=Object.values(__INTERNAL_CPPKIES__.savePartitions);t<n.length;t++)n[t].resetAll(N,e)}function A(e,t){var n,o=(null===(n=e.upgrades)||void 0===n?void 0:n[t.name])||{bought:!1,unlocked:!1};t.unlocked=o.unlocked?1:0,t.bought=o.bought?1:0,t.bought&&Game.CountsAsUpgradeOwned(t.pool)&&Game.UpgradesOwned++}new E("upgrades",1,"soft",(function(e,t){for(var n=0,o=a;n<o.length;n++){var i=o[n];i.owner===t&&(e.upgrades||(e.upgrades={}),e.upgrades[i.name]={bought:!!i.bought,unlocked:!!i.unlocked})}}),(function(e,t){if(e.upgrades)for(var n=0,o=a;n<o.length;n++){var i=o[n];i.owner===t&&A(e,i)}}));var G=function(e){function n(t,n,o,i,r){void 0===r&&(r=function(){});var s=e.call(this,t,"function"==typeof n?"":n,"function"==typeof o?0:o,"function"==typeof i?[0,0]:d(i),r)||this;return u(s),"function"==typeof n&&(s.descFunc=n),"function"==typeof o&&(s.priceFunc=o),"function"==typeof i&&(s.iconFunction=function(){return d(i())}),a.push(s),A(s.owner||N.foreign,s),Game.upgradesToRebuild=1,s}return t(n,e),n}(Game.Upgrade),L=function(){function e(){this._events={}}return e.prototype.on=function(e,t){if(this.forwardTo)return this.forwardTo.on(e,t);var n=this._events[e];n||(this._events[e]=n=[]),n.push(t)},e.prototype.once=function(e,t){var n=this;this.on(e,(function(o){return n.off(e,t),t(o)}))},e.prototype.off=function(e,t){if(this.forwardTo)return this.forwardTo.off(e,t);if(!this._events[e]){var n=this._events[e];n||(this._events[e]=n=[]);var o=n.indexOf(t);n.splice(o,1)}},e.prototype.convertableEmit=function(e,t,n){if(this.forwardTo)return this.forwardTo.convertableEmit(e,t,n);var o=this._events[e];o||(this._events[e]=o=[]);for(var i=n,r=0,a=o;r<a.length;r++)i=(0,a[r])(t(i));return i},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.convertableEmit(e,(function(e){return e}),t[0])},e.prototype.constEmit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.convertableEmit(e,(function(){return t[0]}),t[0])},e.prototype.setForwardTarget=function(e){for(var t in this._events){var n=this._events[t];if(n){var o=e._events[t];o?o.push.apply(o,n):e._events[t]=Array.from(n)}}this.forwardTo=e},e}(),M=!1;var T=new Proxy([],{set:function(e,t,n){return"function"==typeof n&&M?n():e[t]=n,!0}});Promise.resolve();var R=[],K=function(){function e(e,t){this.hookName=e,this.func=t}return e.prototype.runHook=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];O(this.hookName)&&(null===(e=this.func)||void 0===e||e.call(this))},e}();function O(e){return!(null===__INTERNAL_CPPKIES__||void 0===__INTERNAL_CPPKIES__?void 0:__INTERNAL_CPPKIES__.injectedHooks.has(e))&&(__INTERNAL_CPPKIES__.injectedHooks.add(e),!0)}!function(e){function n(t,n){var o=e.call(this,t,n)||this;return o.hookName=t,o.func=n,o}t(n,e),n.prototype.runHook=function(e){var t;__INTERNAL_CPPKIES__.injectedBuildingHooks[e.name]||(__INTERNAL_CPPKIES__.injectedBuildingHooks[e.name]=new Set),function(e,t){var n;return!(null===(n=null===__INTERNAL_CPPKIES__||void 0===__INTERNAL_CPPKIES__?void 0:__INTERNAL_CPPKIES__.injectedBuildingHooks[e])||void 0===n?void 0:n.has(t))&&(__INTERNAL_CPPKIES__.injectedBuildingHooks[e].add(t),!0)}(e.name,this.hookName)&&(null===(t=this.func)||void 0===t||t.call(this))}}(K);var j=new L;function x(e,t){var n,o=(null===(n=e.achievements)||void 0===n?void 0:n[t.name])||{won:!1};t.won=o.won?1:0,t.won&&Game.CountsAsAchievementOwned(t.pool)&&Game.AchievementsOwned++}R.push((function(){__INTERNAL_CPPKIES__.basegame&&__INTERNAL_CPPKIES__.basegame.setForwardTarget(j),[new K("menu",(function(){Game.UpdateMenu=v(Game.UpdateMenu,null,'\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tswitch (Game.onMenu) {\n\t\t\t\t\t\tcase "prefs":\n\t\t\t\t\t\t\t__INTERNAL_CPPKIES__.basegame.emit("optionsMenu")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase "stats":\n\t\t\t\t\t\t\t__INTERNAL_CPPKIES__.basegame.emit("statsMenu")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase "log":\n\t\t\t\t\t\t\t__INTERNAL_CPPKIES__.basegame.emit("logMenu")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\t__INTERNAL_CPPKIES__.basegame.emit("menu")\n\t\t\t\t\t',"after")})),new K("preSave",(function(){Game.WriteSave=v(Game.WriteSave,null,'\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\t__INTERNAL_CPPKIES__.basegame.emit("preSave")\n\t\t\t\t\t',"before")})),new K("postSave",(function(){Game.WriteSave=v(Game.WriteSave,"if (type==2 || type==3)",'\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\t__INTERNAL_CPPKIES__.basegame.emit("postSave")\n\t\t\t\t\t',"before")})),new K("reset",(function(){Game.Reset=v(Game.Reset,null,'\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\t__INTERNAL_CPPKIES__.basegame.constEmit("reset", hard)\n\t\t\t\t\t',"before")})),new K("reincarnate",(function(){Game.registerHook("reincarnate",(function(){return j.emit("reincarnate")}))})),new K("preLoad",(function(){Game.LoadSave=v(Game.LoadSave,null,'__INTERNAL_CPPKIES__.isFirstLoad = false;\n__INTERNAL_CPPKIES__.basegame.emit("preLoad");\n',"before")})),new K("getIcon",(function(){Game.GetIcon=g(Game.GetIcon,[["return [col,Game.Tiers[tier].iconRow];",'// Cppkies Injection\n\t\t\t\t\treturn __INTERNAL_CPPKIES__.basegame.convertableEmit("getIcon", icon => ({ icon: icon, tier: tier, type: type }), [col, Game.Tiers[tier].iconRow])',"replace"],["col=18;",'else if (type === "Mouse") col = 11;',"after"]])})),new K("buildStore",(function(){Game.BuildStore=v(Game.BuildStore,null,';\n__INTERNAL_CPPKIES__.basegame.emit("buildStore")',"after")})),new K("grandmaPic",(function(){Game.Objects.Grandma.art.pic=v(Game.Objects.Grandma.art.pic,"return choose(list)+'.png'",'// Cppkies injection\n\t\t\t\t\tlist = __INTERNAL_CPPKIES__.basegame.emit("grandmaPic", list)\n\t\t\t\t\t',"before")})),new K("cps",(function(){Game.CalculateGains=g(Game.CalculateGains,[["var rawCookiesPs=Game.cookiesPs*mult;",'// Cppkies injection\n\t\t\t\t\tGame.cookiesPs = __INTERNAL_CPPKIES__.basegame.emit("rawCps", Game.cookiesPs);\n\t\t\t\t\tmult = __INTERNAL_CPPKIES__.basegame.emit("rawCpsMult", mult);\n',"before"],["Game.cookiesPs=Game.runModHookOnValue('cps',Game.cookiesPs);",'// Cppkies injection\n\t\t\t\t\t\tmult = __INTERNAL_CPPKIES__.basegame.emit("cpsMult", mult);\n',"before"]]),Game.registerHook("cps",(function(e){return j.emit("cps",e)}))})),new K("cursorFingerMult",(function(){Game.Objects.Cursor.cps=v(Game.Objects.Cursor.cps,"var mult=1;",'// Cppkies injection\nadd = __INTERNAL_CPPKIES__.basegame.emit("cursorFingerMult", add);\n',"before")})),new K("cpc",(function(){Game.mouseCps=g(Game.mouseCps,[["var num=0;",'// Cppkies injection\n\t\t\t\t\t\tadd = __INTERNAL_CPPKIES__.basegame.emit("cursorFingerMult", add);\n',"before"],["var out",'// Cppkies injection\n\t\t\t\t\t\tadd = __INTERNAL_CPPKIES__.basegame.emit("cpcAdd", add);\n',"before"]]),Game.registerHook("cookiesPerClick",(function(e){return j.emit("cpc",e)}))})),new K("buildingCps",(function(){Game.CalculateGains=v(Game.CalculateGains,"me.storedTotalCps=me.amount*me.storedCps;",'// Cppkies injection\nme.storedCps = __INTERNAL_CPPKIES__.basegame.convertableEmit("buildingCps", cps => ({ building: i, cps: cps }), me.storedCps);\n',"before")})),new K("logic",(function(){Game.registerHook("logic",(function(){return j.emit("logic")}))})),new K("draw",(function(){Game.registerHook("draw",(function(){return j.emit("draw")}))})),new K("check",(function(){Game.registerHook("check",(function(){return j.emit("check")}))})),new K("ticker",(function(){Game.getNewTicker=v(Game.getNewTicker,"Game.TickerAge=Game.fps*10;",'// Cppkies injection\nlist = __INTERNAL_CPPKIES__.basegame.emit("ticker", list);\n',"before")})),new K("specialPic",(function(){Game.DrawSpecial=v(Game.DrawSpecial,"if (hovered || selected)",'// Cppkies injection\nconst override = __INTERNAL_CPPKIES__.basegame.convertableEmit("specialPic", ret => ({ tab: Game.specialTabs[i], frame: ret.frame, pic: ret.pic }), { frame: frame, pic: pic })\npic = override.pic\nframe = override.frame;\n',"before"),Game.ToggleSpecialMenu=v(Game.ToggleSpecialMenu,"else {pic='dragon.png?v='+Game.version;frame=4;}",'// Cppkies injection\nconst override = __INTERNAL_CPPKIES__.basegame.convertableEmit("specialPic", ret => ({ tab: Game.specialTabs[i], frame: ret.frame, pic: ret.pic }), { frame: frame, pic: pic })\npic = override.pic\nframe = override.frame;\n',"after")})),new K("autoMoveDragonLevels",(function(){Game.ToggleSpecialMenu=g(Game.ToggleSpecialMenu,[[">=5",'>=Game.dragonLevels.findIndex(val => val.name === "Krumblor, cookie hatchling")',"replace"],[/>=\d{2}/g,'>=Game.dragonLevels.findIndex(val => val.action === "Train secondary aura<br><small>Lets you use two dragon auras simultaneously</small>") + 1',"replace"]])})),new K("loaderFreedom",(function(){Game.UpdateMenu=g(Game.UpdateMenu,[["url(img/'+milk.pic+')","url(' + (milk.pic.indexOf('/') >= 0 ? milk.pic : 'img/' + milk.pic) + ')","replace"],["img/icons.png?v='+Game.version+'","' + (Game.Milks[i].iconLink ? Game.Milks[i].iconLink : 'img/icons.png?v='+Game.version) + '","replace"]])})),new K("milkMult",(function(){Game.CalculateGains=v(Game.CalculateGains,"var catMult=1;","// Cppkies injection\n\t\t\t__INTERNAL_CPPKIES__.hiddenMilkMult = milkMult;\n","before")})),new K("overrideMinigameSave",(function(){Game.LoadSave=v(Game.LoadSave,"if (me.minigame",'if (mestr[4]) mestr[4] = __INTERNAL_CPPKIES__.basegame.convertableEmit("minigameSave", str => ({ building: me, save: str }), mestr[4]);',"before")}))].forEach((function(e){return e.runHook()})),__INTERNAL_CPPKIES__.basegame=j})),new E("achievements",1,"hard",(function(e,t){if(0!==r.length)for(var n=0,o=r;n<o.length;n++){var i=o[n];i.owner===t&&(e.achievements||(e.achievements={}),e.achievements[i.name]={won:!!i.won})}}),(function(e,t){if(e.achievements)for(var n=0,o=r;n<o.length;n++){var i=o[n];i.owner===t&&x(e,i)}}));var H=function(e){function n(t,n,o){var i=e.call(this,t,n,d(o))||this;return u(i),x(i.owner||N.foreign,i),r.push(i),i}return t(n,e),n}(Game.Achievement);new E("custom",1,"never",(function(e,t){t&&(e.custom=t.custom)}),(function(e,t){t&&(t.custom=e.custom)}));var B=function(){function e(e,t){var n,o;this.modFunction=t,this.custom=null,this.toggles=[],this.ownedUnits=[],this.keyname=e.keyname,this.version=e.version,this.name=e.name,this.icon=e.icon;var i=s.find((function(t){return t.keyname===e.keyname}));if(i){if(i.version!==this.version)throw new Error("You are trying to load multiple versions of the same mod");console.warn("Loading the same mod (".concat(i.keyname,") multiple times."))}else s.push(this),this.custom=null!==(o=null===(n=N.mods[this.keyname])||void 0===n?void 0:n.custom)&&void 0!==o?o:null,c(this),null==t||t.apply(this),Game.UpdateMenu(),c(null)}return e.prototype.render=function(){for(var e=document.createElement("div"),t=0,n=this.toggles;t<n.length;t++){var o=n[t];e.appendChild(o.render())}return e},e}(),F={};window.__INTERNAL_CPPKIES_MG_PROMISES_MARK__=function(e){F[e]&&(F[e](),delete F[e])},Game.LoadMinigames=v(Game.LoadMinigames,"document.head.appendChild(script);","\n__INTERNAL_CPPKIES_MG_PROMISES_MARK__(me.name);","after");var D,W=new Proxy({},{get:function(e,t){if("symbol"==typeof t)throw new Error("No such building as [symbol]!");var n=e[t];if(n)return n;var o=Game.Objects[t];if(!o)throw new Error("No such building as ".concat(t,"!"));if(o.minigameLoaded)return e[t]=Promise.resolve();var i=document.querySelector("#minigameScript-"+o.id);return e[t]=new Promise(i?function(e,t){i.addEventListener("load",(function(){return e()})),i.addEventListener("error",t)}:function(e,n){F[t]=function(){var t=document.querySelector("#minigameScript-"+o.id);t&&(t.addEventListener("load",(function(){return e()})),t.addEventListener("error",n))}}),e[t]}}),U=new L;R.push((function(){return function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var e,t,n,o;return function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(i){switch(i.label){case 0:return[4,W.Farm];case 1:for(i.sent(),e=Game.Objects.Farm.minigame,__INTERNAL_CPPKIES__.minigames||(__INTERNAL_CPPKIES__.minigames={}),__INTERNAL_CPPKIES__.minigames.garden&&__INTERNAL_CPPKIES__.minigames.garden.setForwardTarget(U),t=[new K("customIconsGarden",(function(){e.getPlantDesc=v(e.getPlantDesc,"it.icon*48)+'px;","' + (it.iconLink ? 'background-image: url(' + it.iconLink + ');' : '') + '","after",{M:e}),e.seedTooltip=v(e.seedTooltip,"me.icon*48)+'px;","' + (me.iconLink ? 'background-image: url(' + me.iconLink + ');' : '') + '","after",{M:e}),e.buildPanel=v(e.buildPanel,"1]*48)+'px;","' + (me.iconLink ? 'background-image: url(' + me.iconLink + ');' : '') + '","after",{M:e}),e.tileTooltip=g(e.tileTooltip,[["[stage,me.icon]","[stage + (me.iconX || 0),me.icon]","replace"],[/-(\d)\*48/,"-($1 + (me.iconX || 0)) * 48","replace"],["1]*48)+'px;","' + (me.iconLink ? 'background-image: url(' + me.iconLink + ');' : '') + '","after"]],{M:e}),e.draw&&(e.draw=g(e.draw,[["[0,seed.icon]","[(seed.iconX || 0), seed.icon]","replace"],["M.cursorL.style.display='block';",'if (seed.iconLink) M.cursorL.style.backgroundImage = "url(" + seed.iconLink + ")";else M.cursorL.style.backgroundImage = "";',"after"]],{M:e})),e.buildPlot=g(e.buildPlot,[["[stage,me.icon]","[stage + (me.iconX || 0), me.icon]","replace"],["iconL.style.display='block';",'if (me.iconLink) iconL.style.backgroundImage = "url(" + me.iconLink + ")";else iconL.style.backgroundImage = "";',"after"]],{M:e})})),new K("mutations",(function(){e.getMuts=v(e.getMuts,"return muts;",'return __INTERNAL_CPPKIES__.minigames.garden.emit("mutations", { muts, neighs, neighsM }).muts;',"replace",{M:e})})),new K("gardenCppkiesSeeds",(function(){e.save=v(e.save,"str+=''+(M.plants[i].unlocked?'1':'0')","if (!M.plants[i].isCppkies);\n","before",{M:e})})),new K("plotBoosts",(function(){e.computeBoostPlot=v(e.computeBoostPlot,"//by god i hope these are right",'var boostInfo = __INTERNAL_CPPKIES__.minigames.garden.emit("plotBoosts", { x: x, y: y, name: name, age: tile[1], ageMult: ageMult, powerMult: powerMult, weedMult: weedMult, range: range, mult: mult });\n\t\t\t\tageMult = boostInfo.ageMult\n\t\t\t\tpowerMult = boostInfo.powerMult\n\t\t\t\tweedMult = boostInfo.weedMult\n\t\t\t\trange = boostInfo.range\n\t\t\t\tmult = boostInfo.mult;\n',"before",{M:e})})),new K("boosts",(function(){e.computeEffs=v(e.computeEffs,"mult*=M.plotBoost[y][x][1];",'var boostInfo = __INTERNAL_CPPKIES__.minigames.garden.emit("boosts", { x: x, y: y, name: name, age: tile[1], mult: mult, effs: effs })\n\t\t\t\teffs = effs\n\t\t\t\tmult = mult;\n',"before",{M:e})}))],n=0,o=t;n<o.length;n++)o[n].runHook();return __INTERNAL_CPPKIES__.minigames.garden=U,[2]}}))}))})),function(){if(1===Math.acos(1))throw""}(),W.Farm.then((function(){D=Game.Objects.Farm.minigame,V.loadAll(N)}));var X=[],$=function(e,t,n,o,i,r,a,s,l,c){var f,m,d;if(this.name=e,this.key=t,this.cost=o,this.costM=i,this.ageTick=r,this.ageTickR=a,this.matureBase=s,this.q=c,this.children=[],this.isCppkies=!0,this.iconX=0,this.plantable=!0,this.unlocked=!1,this.weed=!1,u(this),!D)throw new Error("The garden minigame has not loaded yet!");if(this.icon=n[0],this.iconX=n[1],this.iconLink=n[2]&&p(n[2]),this.mature=this.matureBase,"string"==typeof l)this.effsStr=l;else{var h=new Q(t,l);this.effsStr=h.toString()}this.id=D.plantsById.push(this)-1,D.plants[t]=this,D.plantsN++,X.push(this),function(e){var t,n;if(D&&(null===(t=N.minigames)||void 0===t?void 0:t.garden)&&N.minigames.garden.plot)for(var o=N.minigames.garden.plot,i=0;i<D.plot.length;i++)for(var r=0;r<D.plot[i].length;r++)if((null===(n=o[i][r])||void 0===n?void 0:n[0])===e.key){var a=o[i][r][1];D.plot[i][r][0]=e.id+1,D.plot[i][r][1]=a}}(this),(null===(d=null===(m=null===(f=N.minigames)||void 0===f?void 0:f.garden)||void 0===m?void 0:m.seeds)||void 0===d?void 0:d.includes(this.key))&&(this.unlocked=!0),D.getUnlockedN(),D.buildPanel(),D.buildPlot()},q=[];function Y(e){var t,n=null===(t=e.match(/^(>=|<=|!=|[><=])/))||void 0===t?void 0:t[0];if(!n)throw new Error("Your string must start with a comparison operator!");return[n,parseInt(e.slice(n.length))]}function J(e,t){if(!D)throw new Error("This should never happen!");for(var n in e){if(!D.plants[n])throw new Error("You aren't giving a real plant id!");for(var o=t[n]||0,i=e[n],r=0,a="string"==typeof i?[i]:i;r<a.length;r++){var s=Y(a[r]),l=s[0],c=s[1],u=!1;switch(l){case">":u=o>c;break;case"<":u=o<c;break;case">=":u=o>=c;break;case"<=":u=o<=c;break;case"=":u=o===c;break;case"!=":u=o!==c}if(!u)return!1}}return!0}O("plantMutations")&&U.on("mutations",(function(e){var t,n=e.muts,o=e.neighs,i=e.neighsM;if(!D)throw new Error("This should never happen!");for(var r=0,a=q;r<a.length;r++){var s=a[r];"function"==typeof s.matches?s.matches(i,o)&&n.push.apply(n,s.results):!(t=s.matches).neighs&&!t.neighsMature||t.neighs instanceof Array||"string"==typeof t.neighs||t.neighsMature instanceof Array||"string"==typeof t.neighsMature?J(s.matches,i)&&n.push.apply(n,s.results):s.matches.neighs&&!J(s.matches.neighs,o)||s.matches.neighsMature&&!J(s.matches.neighsMature,i)||n.push.apply(n,s.results)}return{muts:n,neighs:o,neighsM:i}}));var V=new y("garden",1,"mixed",(function(e){for(var t,n,o,i=(null===(t=e.garden)||void 0===t?void 0:t.seeds)||[],r=0,a=X;r<a.length;r++){var s=a[r],l=i.includes(s.key);s.unlocked&&!l?i.push(s.key):!s.unlocked&&l&&i.splice(i.indexOf(s.key),1)}0===i.length?(null===(n=e.garden)||void 0===n||delete n.seeds,(null===(o=e.garden)||void 0===o?void 0:o.plot)||delete e.garden):e.garden?e.garden.seeds=i:e.garden={seeds:i}}),(function(e){var t;if(D&&(null==e?void 0:e.garden)){if(e.garden.plot)if(__INTERNAL_CPPKIES__.isFirstLoad&&D.nextStep-e.garden.nextStep==1e3*D.stepT){for(var n=e.garden.plot,o=0;o<D.plot.length;o++)for(var i=0;i<D.plot[o].length;i++)if(null!==n[o][i]){var r=n[o][i],a=r[0],s=r[1];D.plot[o][i][0]=D.plants[a].id+1,D.plot[o][i][1]=s}else D.plot[o][i]=[0,0];D.nextStep=e.garden.nextStep,null===(t=D.logic)||void 0===t||t.call(D)}else if(D.nextStep-e.garden.nextStep==0)for(n=e.garden.plot,o=0;o<D.plot.length;o++)for(i=0;i<D.plot[o].length;i++)if(null!==n[o][i]){var l=n[o][i];a=l[0],s=l[1],void 0!==D.plants[a]&&(D.plot[o][i][0]=D.plants[a].id+1,D.plot[o][i][1]=s)}else D.plot[o][i]=[0,0];if(e.garden.seeds)for(var c=0,u=e.garden.seeds;c<u.length;c++)a=u[c],D.plants[a]&&(D.plants[a].unlocked=!0)}}),(function(e,t){var n,o,i;"hard"===t?delete e.garden:(null===(n=e.garden)||void 0===n||delete n.nextStep,null===(o=e.garden)||void 0===o||delete o.plot,(null===(i=e.garden)||void 0===i?void 0:i.seeds)||delete e.garden)}));V.active&&(j.on("preSave",(function(){var e;if(D&&V.active){for(var t=function(e){return new Array(e.length).fill(null).map((function(t,n){return Array(e[n].length).fill(null)}))}(D.plot),n=!1,o=0;o<D.plot.length;o++)for(var i=0;i<D.plot[o].length;i++){var r=D.plot[o][i];if(0!==r[0]){var a=D.plantsById[r[0]-1];t[o][i]=[a.key,r[1]],a instanceof $&&(r[0]=r[1]=0,n=!0)}}n?(N.minigames||(N.minigames={}),N.minigames.garden?(N.minigames.garden.plot=t,N.minigames.garden.nextStep=D.nextStep):N.minigames.garden={plot:t,nextStep:D.nextStep}):(null===(e=N.minigames)||void 0===e?void 0:e.garden)&&(delete N.minigames.garden.nextStep,delete N.minigames.garden.plot)}})),j.on("postSave",(function(){var e,t;if(D&&V.active&&(null===(t=null===(e=N.minigames)||void 0===e?void 0:e.garden)||void 0===t?void 0:t.plot))for(var n=N.minigames.garden.plot,o=0;o<D.plot.length;o++)for(var i=0;i<D.plot[o].length;i++)if(null!==n[o][i]){var r=n[o][i],a=r[0],s=r[1];D.plot[o][i][0]=D.plants[a].id+1,D.plot[o][i][1]=s}})));var z=[],Q=function(){function e(e,t,n){this.plantName=e,this.effects=t,this.customDesc=n,z.push(this)}return e.prototype.toString=function(){if(!D)throw new Error("Wait for the minigame to load!");var e=g(D.tools.info.descFunc,[["M.freeze","false","replace"],["var effStr='';","return effs;}\n/*","before"],[null,"*/","after"]])();if(this.customDesc)return this.customDesc;if("function"==typeof this.effects)throw new Error("Should have supplied `customDesc`!");for(var t="",n=0,o=Object.entries(this.effects);n<o.length;n++){var i=o[n],r=i[0],a=i[1],s=e[r],l=100*(a-1),c=(s.rev?-1:1)*l;t+='<div class="'.concat(c>0?"green":"red",'">&bull; ').concat(s.n," ").concat(l>0?"+":"-").concat(Beautify(Math.abs(l),2),"%</div>")}return t},e}();if(O("plantEffects")&&(U.on("boosts",(function(e){for(var t=0,n=z;t<n.length;t++)for(var o=n[t],i="function"==typeof o.effects?o.effects(e):o.effects,r=0,a=Object.entries(i);r<a.length;r++){var s=a[r],l=s[0],c=s[1];l.startsWith("mult")||l in e.effs&&(c>0?e.effs[l]+=e.mult*c:e.effs[l]*=1-e.mult*c)}return e})),U.on("plotBoosts",(function(e){for(var t=0,n=z;t<n.length;t++)for(var o=n[t],i="function"==typeof o.effects?o.effects(e):o.effects,r=0,a=Object.entries(i);r<a.length;r++){var s=a[r],l=s[0],c=s[1];if(l.startsWith("mult")&&["multAge","multWeed","multPow","multRange"].includes(l)){var u=void 0;if("multAge"===l)u="ageMult";else if("multWeed"===l)u="weedMult";else if("multPow"===l)u="powerMult";else{if("multRange"!==l)continue;u="range"}e[u]*=c}}return e}))),o&&Game.UpdateMenu.toString().includes("Cppkies")&&Game.Prompt('<h3>Hello!</h3>\n<div class="block">\nIt seems like you are trying to load Cppkies 0.3 or higher while having Cppkies 0.2 or lower already loaded.<br/>\nSadly, due to internal changes, Cppkies 0.3 mods are incompatible with Cppkies 0.2 mods. <br/>\n(The mod will still be launched, but it may or may not work correctly)<br/>\n<small>((If you are a mod author, please update your mods to use Cppkies 0.3 or higher.))</small><br/>\n</div>',[["Ok".concat(Math.random()<.01?" boomer":""),"Game.ClosePrompt()"]]),R.map((function(e){return e()})),M=!0,o){Game.Notify("Cppkies loaded!","",[32,17],1.5);var Z=document.createElement("div");Z.textContent="Cppkies!";var ee=document.querySelector("#topBar");ee&&ee.insertBefore(Z,ee.children[1]),Game.modSaveData.cppkies||(Game.modSaveData.cppkies="{}"),Game.registerMod("cppkies",{save:function(){return function(){for(var e=0,t=s;e<t.length;e++){var n=t[e];N.mods[n.keyname]={custom:null}}for(var o=0,i=Object.values(__INTERNAL_CPPKIES__.savePartitions);o<i.length;o++)i[o].saveAll(N);for(var r=0,a=s;r<a.length;r++){n=a[r];var l=N.mods[n.keyname];1===Object.keys(l).length&&null===l.custom&&delete N.mods[n.keyname]}N.identification={seed:Game.seed,startDate:Game.startDate}}(),function(e){return null==e?"":P(e,15,(function(e){return w(e+32)}))+" "}(JSON.stringify(N))},load:function(e){if(""===e||"{}"===e)S();else try{var t=function(e){return null==e?"":""==e?null:b(e.length,16384,(function(t){return e.charCodeAt(t)-32}))}(e);(!t||t.length<10)&&(t=e);var n=JSON.parse(t);_(N,n)}catch(e){console.warn("CPPKIES: Found invalid save, creating new one..."),console.error(e),S()}!function(){for(var e=0,t=Object.values(__INTERNAL_CPPKIES__.savePartitions);e<t.length;e++)t[e].loadAll(N);Game.seed!==N.identification.seed&&(console.warn("Seed mismatch! Looks like a soft reset happened without Cppkies, soft-resetting..."),C("soft")),Game.startDate!==N.identification.startDate&&(console.warn("Start date mismatch! Looks like this is a completely different save, hard-resetting..."),C("hard"))}()},init:function(){}}),Game.registerHook("reset",(function(e){C(e?"hard":"soft")}))}T.forEach((function(e){return e()})),o&&(window.CPPKIES_ONLOAD||(window.CPPKIES_ONLOAD=[]),window.CPPKIES_ONLOAD.forEach((function(e){return e()})),window.CPPKIES_ONLOAD=new Proxy([],{set:function(e,t,n){return"length"!==t&&n(),!0}}));var te={icon:[0,0],name:"Awesome mod"};new B({keyname:"cppkies-ts-template",version:"1.0.0",icon:te.icon,name:te.name},(function(){new G("Hello, World!","My first upgrade!",7,[10,5]),Game.Unlock("Hello, World!"),new H("Hello, New World!","Buy the <b>Hello, World!</b> upgrade!",[10,5]),j.on("check",(function(){Game.Has("Hello, World!")&&Game.Win("Hello, New World!")})),console.log(z)}))}));
//# sourceMappingURL=index.js.map
